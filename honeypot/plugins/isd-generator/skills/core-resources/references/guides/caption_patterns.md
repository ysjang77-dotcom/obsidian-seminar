# 캡션 추출 패턴 가이드

본 가이드는 연구계획서 문서에서 이미지 캡션을 추출하고 분류하는 방법을 정의한다.

---

## 1. 캡션 형식

### 표준 캡션 형식

연구계획서 문서에서 이미지 위치는 다음 형식으로 표시된다:

```
<이미지명>                           # 기본 형식
<이미지명, 출처: 기관명 (연도)>       # 출처 포함 형식
```

### 예시

```markdown
<연구개발 목표 및 비전>
<기술개발 로드맵>
<사업 추진 체계>
<시장규모 전망, 출처: MarketsandMarkets (2024)>
<기술분류 체계도, 출처: KISTEP (2023)>
```

---

## 2. 정규식 패턴

### 기본 추출 패턴

```regex
/<([^,>]+)(,\s*출처:\s*[^>]+)?>/g
```

### 패턴 설명

| 부분 | 설명 | 매칭 예시 |
|------|------|----------|
| `<` | 시작 괄호 | `<` |
| `([^,>]+)` | 캡션명 (쉼표, > 제외) | `연구개발 목표 및 비전` |
| `(,\s*출처:\s*[^>]+)?` | 출처 (선택) | `, 출처: 기관명 (연도)` |
| `>` | 종료 괄호 | `>` |

### 추출 결과 구조

```
{
  "full_match": "<연구개발 목표 및 비전>",
  "caption_name": "연구개발 목표 및 비전",
  "source": null
}

{
  "full_match": "<시장규모 전망, 출처: MarketsandMarkets (2024)>",
  "caption_name": "시장규모 전망",
  "source": "MarketsandMarkets (2024)"
}
```

---

## 3. 캡션 유형 분류

### 분류 기준

캡션명에 포함된 키워드를 기반으로 9가지 유형으로 분류한다.

### 유형별 키워드 및 이미지 스타일

| 유형 | 우선순위 | 키워드 | 이미지 스타일 |
|------|----------|--------|--------------|
| 비전/목표 | 1 | 목표, 비전, 개념, 최종목표, 연구목표 | 계층 구조도, 피라미드 |
| 로드맵 | 2 | 로드맵, 일정, 타임라인, 마일스톤 | 타임라인, 간트 차트 |
| 연차별 | 3 | 연차별, 년차별, 단계별, 연도별, 1단계, 2단계 | 테이블, 타임라인 |
| 추진체계 | 4 | 추진체계, 조직, 역할, R&R, 거버넌스 | 조직도 |
| 투자계획 | 5 | 투자, 예산, 재원, 비용, 자금 | 막대 그래프, 파이 차트 |
| 협력체계 | 6 | 협력, 네트워크, 파트너, 컨소시엄 | 네트워크 다이어그램 |
| 사업화 | 7 | 사업화, 상용화, 활용, 적용, 시장진출 | 흐름도, 로드맵 |
| 개념도 | 8 | 개념, 구조, 아키텍처, 시스템, 프레임워크 | 블록 다이어그램 |
| 기술분류 | 9 | 기술분류, 체계, 분류, 트리, 계통 | Technology Tree |

### 분류 알고리즘

```
1. 캡션명을 소문자로 변환
2. 각 유형의 키워드 목록과 매칭
3. 먼저 매칭되는 유형으로 분류
4. 매칭 안 되면 "개념도"(기본값)로 분류
```

### 유형별 상세 정보

#### 1. 비전/목표 유형

```
키워드: 목표, 비전, 개념, 최종목표, 연구목표, 핵심목표
이미지 스타일: 계층 구조도, 피라미드
레이아웃 특징:
- 최상단: 최종 목표 (네이비 배경)
- 중단: 3개 세부기술 (청록색 테두리)
- 하단: 기대효과/적용분야 (녹색 강조)
- 수직 화살표로 연결
```

**예시 캡션:**
- `<연구개발 목표 및 비전>`
- `<최종 연구 목표>`
- `<사업 비전 및 목표>`

#### 2. 로드맵 유형

```
키워드: 로드맵, 일정, 타임라인, 마일스톤, 추진일정
이미지 스타일: 타임라인, 간트 차트
레이아웃 특징:
- 가로 축: 시간 (1단계/2단계 또는 연차)
- 상단: 단계별 핵심 목표
- 중단: 세부기술별 마일스톤
- 하단: 성과물
- 전반기(청록)/후반기(네이비) 색상 구분
```

**예시 캡션:**
- `<기술개발 로드맵>`
- `<연구개발 추진 일정>`
- `<기술 마일스톤>`

#### 3. 연차별 유형

```
키워드: 연차별, 년차별, 단계별, 연도별, 1단계, 2단계, 3단계
이미지 스타일: 테이블, 타임라인
레이아웃 특징:
- 테이블 형식 (연차 x 내용)
- 또는 타임라인 형식 (가로 배열)
- 연차별 목표/내용 명시
- 단계 구분 색상 적용
```

**예시 캡션:**
- `<연차별 연구목표 및 내용>`
- `<단계별 추진계획>`
- `<연도별 성과목표>`

#### 4. 추진체계 유형

```
키워드: 추진체계, 조직, 역할, R&R, 거버넌스, 수행체계
이미지 스타일: 조직도
레이아웃 특징:
- 최상단: 주관기관 (크게, 네이비)
- 중단: 협력/위탁기관 (청록색)
- 실선/점선으로 관계 표시
- 각 박스 하단에 역할 기술
```

**예시 캡션:**
- `<사업 추진 체계>`
- `<연구개발 조직도>`
- `<참여기관 R&R>`

#### 5. 투자계획 유형

```
키워드: 투자, 예산, 재원, 비용, 자금, 연구비
이미지 스타일: 막대 그래프, 파이 차트, 테이블
레이아웃 특징:
- 연도별/기술별 투자금액 시각화
- 막대 그래프: 누적/그룹화
- 범례 포함
- 금액 단위 명시 (억원)
```

**예시 캡션:**
- `<연도별 기술별 투자계획>`
- `<연구비 배분 계획>`
- `<예산 편성 현황>`

#### 6. 협력체계 유형

```
키워드: 협력, 네트워크, 파트너, 컨소시엄, 공동연구
이미지 스타일: 네트워크 다이어그램
레이아웃 특징:
- 중심: 주관기관
- 주변: 협력기관/파트너
- 연결선으로 관계 표시
- 역할/기여 내용 기재
```

**예시 캡션:**
- `<협력체계>`
- `<산학연 네트워크>`
- `<컨소시엄 구성도>`

#### 7. 사업화 유형

```
키워드: 사업화, 상용화, 활용, 적용, 시장진출, 기술이전
이미지 스타일: 흐름도, 로드맵
레이아웃 특징:
- 단계별 흐름 (연구 → 개발 → 실증 → 사업화)
- 각 단계별 활동/성과 명시
- 최종 목표/시장 도달점 강조
```

**예시 캡션:**
- `<기술 사업화 전략>`
- `<상용화 로드맵>`
- `<기술이전 및 활용계획>`

#### 8. 개념도 유형

```
키워드: 개념, 구조, 아키텍처, 시스템, 프레임워크, 플랫폼
이미지 스타일: 블록 다이어그램
레이아웃 특징:
- 시스템/기술 구성요소 표현
- 블록 간 관계/흐름 표시
- 계층 구조 또는 모듈 구조
- 입출력 흐름 명시
```

**예시 캡션:**
- `<사업개념도>`
- `<시스템 아키텍처>`
- `<플랫폼 구조도>`

#### 9. 기술분류 유형

```
키워드: 기술분류, 체계, 분류, 트리, 계통, 분류체계
이미지 스타일: Technology Tree
레이아웃 특징:
- 트리 구조 (상위 → 하위)
- 기술 카테고리별 분류
- 세부 기술 나열
- 연구범위 표시
```

**예시 캡션:**
- `<기술분류 체계도>`
- `<기술 트리>`
- `<세부기술 분류>`

---

## 4. 캡션 목록 생성 형식

### caption_list.md 구조

```markdown
# 캡션 목록

## 요약
- 총 캡션 수: [N]개
- 문서별 분포: [Chapter별 개수]
- 유형별 분포: [유형별 개수]

## 문서별 캡션 분포

| 문서 | 캡션 수 |
|------|---------|
| chapter_1/*.md | [N]개 |
| chapter_2/*.md | [N]개 |
| chapter_3/*.md | [N]개 |
| chapter_4/*.md | [N]개 |
| chapter_5/*.md | [N]개 |

## 유형별 캡션 분포

| 유형 | 캡션 수 | 비율 |
|------|---------|------|
| 비전/목표 | [N]개 | [%]% |
| 로드맵 | [N]개 | [%]% |
| ... | ... | ... |

## 캡션 상세 목록

| 번호 | 캡션명 | 유형 | 출처 문서 | 라인 |
|------|--------|------|----------|------|
| 01 | 연구개발 목표 및 비전 | 비전/목표 | chapter_3/연구목표.md | 45 |
| 02 | 기술개발 로드맵 | 로드맵 | chapter_3/연구목표.md | 78 |
| ... | ... | ... | ... | ... |
```

---

## 5. 예외 처리

### 무시할 패턴

다음 패턴은 이미지 캡션이 아니므로 무시한다:

```
- HTML 태그: <div>, <span>, <table> 등
- 마크다운 구문: <br>, <hr> 등
- 변수/플레이스홀더: <변수명>, <입력값> 등
- 코드 내 제네릭: List<String>, Map<K,V> 등
```

### 무시 규칙

```
1. 영문 태그명 (소문자만): <div>, <table>, <span>
2. 마크다운 태그: <br>, <hr>
3. 3글자 이하 캡션: <A>, <AB>
4. 코드 블록 내 패턴: ```코드``` 내부
```

### 중복 처리

```
- 동일 캡션이 여러 번 등장하면 1회만 처리
- 첫 번째 등장 위치 기록
- 중복 횟수 별도 기록 (참고용)
```

---

## 6. 파일명 변환 규칙

### 캡션명 → 파일명 변환

```
1. 공백 → 언더스코어(_)
2. 특수문자 제거 (한글, 영문, 숫자, _ 만 허용)
3. 연속 언더스코어 → 단일 언더스코어
4. 순번 접두사 추가 (2자리: 01, 02, ...)
```

### 예시

| 캡션명 | 파일명 |
|--------|--------|
| `연구개발 목표 및 비전` | `01_연구개발_목표_및_비전` |
| `기술개발 로드맵` | `02_기술개발_로드맵` |
| `사업 추진 체계` | `03_사업_추진_체계` |
| `연도별 기술별 투자계획` | `04_연도별_기술별_투자계획` |

### 파일 확장자

- 프롬프트 파일: `.md`
- 이미지 파일: `.png`
