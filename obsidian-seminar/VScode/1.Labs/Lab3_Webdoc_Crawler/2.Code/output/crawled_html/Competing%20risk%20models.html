<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<img alt="_images/logo.png" src="_images/logo.png"/>
<hr class="docutils"/>
<section id="competing-risks-models">
<h1>Competing risks models<a class="headerlink" href="#competing-risks-models" title="Link to this heading"></a></h1>
<section id="what-are-competing-risks-models">
<h2>What are competing risks models?<a class="headerlink" href="#what-are-competing-risks-models" title="Link to this heading"></a></h2>
<p>Competing risks models are a combination of two or more distributions that represent failure modes which are “competing” to end the life of the system being modelled. This model is similar to a <a class="reference external" href="https://reliability.readthedocs.io/en/latest/Mixture%20models.html">mixture model</a> in the sense that it uses multiple distributions to create a new model that has a shape with more flexibility than a single distribution. However, unlike in mixture models, we are not adding proportions of the PDF or CDF, but are instead multiplying the survival functions. The formula for the competing risks model is typically written in terms of the survival function (SF). Since we may consider the system’s reliability to depend on the reliability of all the parts of the system (each with its own failure modes), the equation is written as if the system was in series, using the product of the survival functions for each failure mode. For a competing risks model with 2 distributions, the equations are shown below:</p>
<p><span class="math notranslate nohighlight">\({SF}_{Competing\,Risks} = {SF}_1 \times {SF}_2\)</span></p>
<p><span class="math notranslate nohighlight">\({CDF}_{Competing\,Risks} = 1-{SF}_{Competing\,Risks}\)</span></p>
<p>Since <span class="math notranslate nohighlight">\({SF} = exp(-CHF)\)</span> we may equivalently write the competing risks model in terms of the hazard or cumulative hazard function as:</p>
<p><span class="math notranslate nohighlight">\({HF}_{Competing\,Risks} = {HF}_1 + {HF}_2\)</span></p>
<p><span class="math notranslate nohighlight">\({CHF}_{Competing\,Risks} = {CHF}_1 + {CHF}_2\)</span></p>
<p><span class="math notranslate nohighlight">\({PDF}_{Competing\,Risks} = {HF}_{Competing\,Risks} \times {SF}_{Competing\,Risks}\)</span></p>
<p>The image below illustrates the difference between the competing risks model and the mixture model, each of which is made up of the same two component distributions. Note that the PDF of the competing risks model is always equal to or to the left of the component distributions, and the CDF is equal to or higher than the component distributions. This shows how a failure mode that occurs earlier in time can end the lives of units under observation before the second failure mode has the chance to. This behaviour is characteristic of real systems which experience multiple failure modes, each of which could cause system failure.</p>
<img alt="_images/CRvsMM1.png" src="_images/CRvsMM1.png"/>
<p>Competing risks models are useful when there is more than one failure mode that is generating the failure data. This can be recognised by the shape of the PDF and CDF being outside of what any single distribution can accurately model. On a probability plot, a combination of failure modes can be identified by bends in the data that you might otherwise expect to be linear. An example of this is shown in the image below. You should not use a competing risks model just because it fits your data better than a single distribution, but you should use a competing risks model if you suspect that there are multiple failure modes contributing to the failure data you are observing. To judge whether a competing risks model is justified, look at the goodness of fit criterion (AICc or BIC) which penalises the score based on the number of parameters in the model. The closer the goodness of fit criterion is to zero, the better the fit. It is not appropriate to use the Log-likelihood or AD goodness of fit criterions as these do not penalise the score based on the number of parameters, therefore making the model susceptible to overfitting.</p>
<p>See also <a class="reference external" href="https://reliability.readthedocs.io/en/latest/Mixture%20models.html">mixture models</a> for another method of combining distributions using the sum of the CDF rather than the product of the SF.</p>
<img alt="_images/CRprobplot1.png" src="_images/CRprobplot1.png"/>
</section>
<section id="creating-a-competing-risks-model">
<h2>Creating a competing risks model<a class="headerlink" href="#creating-a-competing-risks-model" title="Link to this heading"></a></h2>
<p>Within <cite>reliability.Distributions</cite> is the Competing_Risks_Model. This function accepts an array or list of distribution objects created using the reliability.Distributions module (available distributions are Exponential, Weibull, Gumbel, Normal, Lognormal, Loglogistic, Gamma, Beta). There is no limit to the number of components you can add to the model, but it is generally preferable to use as few as are required to fit the data appropriately (typically 2 or 3). Unlike the mixture model, you do not need to specify any proportions.</p>
<p>As this process is multiplicative for the survival function (or additive for the hazard function), and may accept many distributions of different types, the mathematical formulation quickly gets complex. For this reason, the algorithm combines the models numerically rather than empirically so there are no simple formulas for many of the descriptive statistics (mean, median, etc.). Also, the accuracy of the model is dependent on xvals. If the xvals array is small (&lt;100 values) then the answer will be “blocky” and inaccurate. The variable xvals is only accepted for PDF, CDF, SF, HF, and CHF. The other methods (like random samples) use the default xvals for maximum accuracy. The default number of values generated when xvals is not given is 1000. Consider this carefully when specifying xvals in order to avoid inaccuracies in the results.</p>
<div class="admonition-api-reference admonition">
<p class="admonition-title">API Reference</p>
<p>For inputs and outputs see the <a class="reference external" href="https://reliability.readthedocs.io/en/latest/API/Distributions/Competing_Risks_Model.html">API reference</a>.</p>
</div>
<section id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Link to this heading"></a></h3>
<p>The following example shows how the Competing_Risks_Model object can be created, visualised and used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Distributions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lognormal_Distribution</span><span class="p">,</span> <span class="n">Gamma_Distribution</span><span class="p">,</span> <span class="n">Weibull_Distribution</span><span class="p">,</span> <span class="n">Competing_Risks_Model</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># create the competing risks model</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">Lognormal_Distribution</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">d3</span> <span class="o">=</span> <span class="n">Gamma_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">CR_model</span> <span class="o">=</span> <span class="n">Competing_Risks_Model</span><span class="p">(</span><span class="n">distributions</span><span class="o">=</span><span class="p">[</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">])</span>

<span class="c1"># plot the 5 functions using the plot() function</span>
<span class="n">CR_model</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="c1"># plot the PDF and CDF</span>
<span class="n">plot_components</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># this plots the component distributions. Default is False</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">CR_model</span><span class="o">.</span><span class="n">PDF</span><span class="p">(</span><span class="n">plot_components</span><span class="o">=</span><span class="n">plot_components</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">CR_model</span><span class="o">.</span><span class="n">CDF</span><span class="p">(</span><span class="n">plot_components</span><span class="o">=</span><span class="n">plot_components</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># extract the mean of the distribution</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'The mean of the distribution is:'</span><span class="p">,</span> <span class="n">CR_model</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>

<span class="sd">'''</span>
<span class="sd">The mean of the distribution is: 27.04449126273065</span>
<span class="sd">'''</span>
</pre></div>
</div>
<img alt="_images/CR_model_plotV2.png" src="_images/CR_model_plotV2.png"/>
<img alt="_images/CR_model_PDF_CDFV2.png" src="_images/CR_model_PDF_CDFV2.png"/>
</section>
</section>
<section id="fitting-a-competing-risks-model">
<h2>Fitting a competing risks model<a class="headerlink" href="#fitting-a-competing-risks-model" title="Link to this heading"></a></h2>
<p>Within <cite>reliability.Fitters</cite> is Fit_Weibull_CR. This function will fit a Weibull Competing Risks Model consisting of 2 x Weibull_2P distributions (this does not fit the gamma parameter). Just as with all of the other distributions in <cite>reliability.Fitters</cite>, right censoring is supported.</p>
<p>Whilst some failure modes may not be fitted as well by a Weibull distribution as they may be by another distribution, it is unlikely that a competing risks model of data from two distributions (particularly if they are overlapping) will be fitted noticeably better by other types of competing risks models than would be achieved by a Weibull Competing Risks Model. For this reason, other types of competing risks models are not implemented.</p>
<div class="admonition-api-reference admonition">
<p class="admonition-title">API Reference</p>
<p>For inputs and outputs see the <a class="reference external" href="https://reliability.readthedocs.io/en/latest/API/Fitters/Fit_Weibull_CR.html">API reference</a>.</p>
</div>
<section id="example-2">
<h3>Example 2<a class="headerlink" href="#example-2" title="Link to this heading"></a></h3>
<p>In this example, we will create some data using a competing risks model from two Weibull distributions. We will then fit the Weibull mixture model to the data and will print the results and show the plot.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Distributions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Weibull_Distribution</span><span class="p">,</span> <span class="n">Competing_Risks_Model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Fitters</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fit_Weibull_CR</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Other_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">histogram</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># create some data that requires a competing risks models</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">CR_model</span> <span class="o">=</span> <span class="n">Competing_Risks_Model</span><span class="p">(</span><span class="n">distributions</span><span class="o">=</span><span class="p">[</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">CR_model</span><span class="o">.</span><span class="n">random_samples</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># fit the Weibull competing risks model</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">Fit_Weibull_CR</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># this section is to visualise the histogram with PDF and CDF</span>
<span class="c1"># it is not part of the default output from the Fitter</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">PDF</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">CDF</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="sd">'''</span>
<span class="sd">Results from Fit_Weibull_CR (95% CI):</span>
<span class="sd">Analysis method: Maximum Likelihood Estimation (MLE)</span>
<span class="sd">Optimizer: L-BFGS-B</span>
<span class="sd">Failures / Right censored: 100/0 (0% right censored)</span>

<span class="sd">Parameter  Point Estimate  Standard Error  Lower CI  Upper CI</span>
<span class="sd">  Alpha 1         55.2695         14.3883   33.1812   92.0615</span>
<span class="sd">   Beta 1         1.89484        0.452994   1.18598   3.02738</span>
<span class="sd">  Alpha 2          38.175         1.07992    36.116   40.3514</span>
<span class="sd">   Beta 2         7.97514         1.18035   5.96701   10.6591</span>

<span class="sd">Goodness of fit    Value</span>
<span class="sd"> Log-likelihood -352.479</span>
<span class="sd">           AICc   713.38</span>
<span class="sd">            BIC  723.379</span>
<span class="sd">             AD 0.390325</span>
<span class="sd">'''</span>
</pre></div>
</div>
<img alt="_images/CR_fit_probplot2.png" src="_images/CR_fit_probplot2.png"/>
<img alt="_images/CR_fit_hist1.png" src="_images/CR_fit_hist1.png"/>
</section>
<section id="example-3">
<h3>Example 3<a class="headerlink" href="#example-3" title="Link to this heading"></a></h3>
<p>In this example, we will compare the mixture model to the competing risks model. The data is generated from a competing risks model so we expect the Weibull competing risks model to be more appropriate than the Mixture model. Through comparison of the AICc or BIC, we can see which model is more appropriate. Since the AICc and BIC penalise the goodness of fit criterion based on the number of parameters and the mixture model has 5 parameters compared to the competing risk model’s 4 parameters, we expect the competing risks model to have a lower (closer to zero) goodness of fit than the Mixture model, and this is what we observe in the results. Notice how the log-likelihood and AD statistics of the mixture model indicates a better fit (because the value is closer to zero), but this does not take into account the number of parameters in the model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Distributions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Weibull_Distribution</span><span class="p">,</span> <span class="n">Competing_Risks_Model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Fitters</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fit_Weibull_CR</span><span class="p">,</span> <span class="n">Fit_Weibull_Mixture</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># create some data from a competing risks model</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">210</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">CR_model</span> <span class="o">=</span> <span class="n">Competing_Risks_Model</span><span class="p">(</span><span class="n">distributions</span><span class="o">=</span><span class="p">[</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">CR_model</span><span class="o">.</span><span class="n">random_samples</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">CR_fit</span> <span class="o">=</span> <span class="n">Fit_Weibull_CR</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># fit the Weibull competing risks model</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'----------------------------------------'</span><span class="p">)</span>
<span class="n">MM_fit</span> <span class="o">=</span> <span class="n">Fit_Weibull_Mixture</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># fit the Weibull mixture model</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'----------------------------------------'</span><span class="p">)</span>

<span class="c1"># create a dataframe to display the goodness of fit criterion as a table</span>
<span class="n">goodness_of_fit</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'Model'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Competing Risks'</span><span class="p">,</span> <span class="s1">'Mixture'</span><span class="p">],</span> <span class="s1">'AICc'</span><span class="p">:</span> <span class="p">[</span><span class="n">CR_fit</span><span class="o">.</span><span class="n">AICc</span><span class="p">,</span> <span class="n">MM_fit</span><span class="o">.</span><span class="n">AICc</span><span class="p">],</span> <span class="s1">'BIC'</span><span class="p">:</span> <span class="p">[</span><span class="n">CR_fit</span><span class="o">.</span><span class="n">BIC</span><span class="p">,</span> <span class="n">MM_fit</span><span class="o">.</span><span class="n">BIC</span><span class="p">],</span> <span class="s1">'AD'</span><span class="p">:</span> <span class="p">[</span><span class="n">CR_fit</span><span class="o">.</span><span class="n">AD</span><span class="p">,</span> <span class="n">MM_fit</span><span class="o">.</span><span class="n">AD</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">goodness_of_fit</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'Model'</span><span class="p">,</span> <span class="s1">'AICc'</span><span class="p">,</span> <span class="s1">'BIC'</span><span class="p">,</span> <span class="s1">'AD'</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="sd">'''</span>
<span class="sd">Results from Fit_Weibull_CR (95% CI):</span>
<span class="sd">Analysis method: Maximum Likelihood Estimation (MLE)</span>
<span class="sd">Optimizer: L-BFGS-B</span>
<span class="sd">Failures / Right censored: 50/0 (0% right censored)</span>

<span class="sd">Parameter  Point Estimate  Standard Error  Lower CI  Upper CI</span>
<span class="sd">  Alpha 1         229.868         51.2178   148.531   355.744</span>
<span class="sd">   Beta 1         2.50124        0.747103   1.39286   4.49162</span>
<span class="sd">  Alpha 2         199.717         8.56554   183.615   217.231</span>
<span class="sd">   Beta 2         9.20155         2.20135   5.75734   14.7062</span>

<span class="sd">Goodness of fit    Value</span>
<span class="sd"> Log-likelihood -255.444</span>
<span class="sd">           AICc  519.777</span>
<span class="sd">            BIC  526.536</span>
<span class="sd">             AD 0.582534</span>

<span class="sd">----------------------------------------</span>
<span class="sd">Results from Fit_Weibull_Mixture (95% CI):</span>
<span class="sd">Analysis method: Maximum Likelihood Estimation (MLE)</span>
<span class="sd">Optimizer: TNC</span>
<span class="sd">Failures / Right censored: 50/0 (0% right censored)</span>

<span class="sd">   Parameter  Point Estimate  Standard Error  Lower CI  Upper CI</span>
<span class="sd">     Alpha 1          100.43         12.4535    78.761    128.06</span>
<span class="sd">      Beta 1         4.07764          1.2123   2.27689   7.30257</span>
<span class="sd">     Alpha 2         189.763         5.13937   179.953   200.108</span>
<span class="sd">      Beta 2         7.70223         1.35191   5.46024   10.8648</span>
<span class="sd">Proportion 1        0.215599       0.0815976 0.0964618  0.414394</span>

<span class="sd">Goodness of fit    Value</span>
<span class="sd"> Log-likelihood -254.471</span>
<span class="sd">           AICc  520.306</span>
<span class="sd">            BIC  528.503</span>
<span class="sd">             AD 0.529294</span>

<span class="sd">----------------------------------------</span>
<span class="sd">             Model    AICc     BIC       AD</span>
<span class="sd">0  Competing Risks 519.777 526.536 0.582534</span>
<span class="sd">1          Mixture 520.306 528.503 0.529294</span>
<span class="sd">'''</span>
</pre></div>
</div>
<img alt="_images/CRvsMM_fitV4.png" src="_images/CRvsMM_fitV4.png"/>
</section>
</section>
</section>
</div>
</div>