<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<img alt="_images/logo.png" src="_images/logo.png"/>
<hr class="docutils"/>
<section id="kaplan-meier">
<h1>Kaplan-Meier<a class="headerlink" href="#kaplan-meier" title="Link to this heading"></a></h1>
<div class="admonition-api-reference admonition">
<p class="admonition-title">API Reference</p>
<p>For inputs and outputs see the <a class="reference external" href="https://reliability.readthedocs.io/en/latest/API/Nonparametric/KaplanMeier.html">API reference</a>.</p>
</div>
<p>The Kaplan-Meier estimator provides a method by which to estimate the survival function (reliability function) of a population without assuming that the data comes from a particular distribution. Due to the lack of parameters required in this model, it is a non-parametric method of obtaining the survival function. With a few simple transformations, the survival function (SF) can be used to obtain the cumulative hazard function (CHF) and the cumulative distribution function (CDF). It is not possible to obtain a useful version of the probability density function (PDF) or hazard function (HF) as this would require the differentiation of the CDF and CHF respectively, which results in a very spikey plot due to the non-continuous nature of these plots.</p>
<p>The Kaplan-Meier estimator is very similar in result (but quite different in method) to the <a class="reference external" href="https://reliability.readthedocs.io/en/latest/Nelson-Aalen.html">Nelson-Aalen estimator</a> and <a class="reference external" href="https://reliability.readthedocs.io/en/latest/Rank%20Adjustment.html">Rank Adjustment estimator</a>. While none of the three has been proven to be more accurate than the others, the Kaplan-Meier estimator is generally more popular as a non-parametric means of estimating the SF. Confidence intervals are provided using the <a class="reference external" href="https://support.minitab.com/en-us/minitab/18/help-and-how-to/modeling-statistics/reliability/how-to/nonparametric-distribution-analysis-right-censoring/methods-and-formulas/estimation-methods/#confidence-intervals">Greenwood method</a> with Normal approximation.</p>
<p>The Kaplan-Meier estimator can be used with both complete and right censored data. This function can be accessed from <cite>reliability.Nonparametric.KaplanMeier</cite>.</p>
<section id="example-1">
<h2>Example 1<a class="headerlink" href="#example-1" title="Link to this heading"></a></h2>
<p>In this first example, we will provide Kaplan-Meier with a list of failure times and right censored times. By leaving everything else unspecified, the plot will be shown with the confidence intervals shaded. We will layer this first Kaplan-Meier plot with a second one using just the failure data. As can be seen in the example below, the importance of including censored data is paramount to obtain an accurate estimate of the reliability, because without it the population’s survivors are not included so the reliability will appear much lower than it truly is.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Nonparametric</span><span class="w"> </span><span class="kn">import</span> <span class="n">KaplanMeier</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5248</span><span class="p">,</span> <span class="mi">7454</span><span class="p">,</span> <span class="mi">16890</span><span class="p">,</span> <span class="mi">17200</span><span class="p">,</span> <span class="mi">38700</span><span class="p">,</span> <span class="mi">45000</span><span class="p">,</span> <span class="mi">49390</span><span class="p">,</span> <span class="mi">69040</span><span class="p">,</span> <span class="mi">72280</span><span class="p">,</span> <span class="mi">131900</span><span class="p">]</span>
<span class="n">rc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3961</span><span class="p">,</span> <span class="mi">4007</span><span class="p">,</span> <span class="mi">4734</span><span class="p">,</span> <span class="mi">6054</span><span class="p">,</span> <span class="mi">7298</span><span class="p">,</span> <span class="mi">10190</span><span class="p">,</span> <span class="mi">23060</span><span class="p">,</span> <span class="mi">27160</span><span class="p">,</span> <span class="mi">28690</span><span class="p">,</span> <span class="mi">37100</span><span class="p">,</span> <span class="mi">40060</span><span class="p">,</span> <span class="mi">45670</span><span class="p">,</span> <span class="mi">53000</span><span class="p">,</span> <span class="mi">67000</span><span class="p">,</span> <span class="mi">69630</span><span class="p">,</span> <span class="mi">77350</span><span class="p">,</span> <span class="mi">78470</span><span class="p">,</span> <span class="mi">91680</span><span class="p">,</span> <span class="mi">105700</span><span class="p">,</span> <span class="mi">106300</span><span class="p">,</span> <span class="mi">150400</span><span class="p">]</span>
<span class="n">KaplanMeier</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">right_censored</span><span class="o">=</span><span class="n">rc</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Failures + right censored'</span><span class="p">)</span>
<span class="n">KaplanMeier</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Failures only'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Kaplan-Meier estimates showing the</span><span class="se">\n</span><span class="s1">importance of including censored data'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Miles to failure'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="sd">'''</span>
<span class="sd">Results from KaplanMeier (95% CI):</span>
<span class="sd"> Failure times  Censoring code (censored=0)  Items remaining  Kaplan-Meier Estimate  Lower CI bound  Upper CI bound</span>
<span class="sd">          3961                            0               31                      1               1               1</span>
<span class="sd">          4007                            0               30                      1               1               1</span>
<span class="sd">          4734                            0               29                      1               1               1</span>
<span class="sd">          5248                            1               28               0.964286        0.895548               1</span>
<span class="sd">          6054                            0               27               0.964286        0.895548               1</span>
<span class="sd">          7298                            0               26               0.964286        0.895548               1</span>
<span class="sd">          7454                            1               25               0.925714        0.826513               1</span>
<span class="sd">         10190                            0               24               0.925714        0.826513               1</span>
<span class="sd">         16890                            1               23               0.885466         0.76317               1</span>
<span class="sd">         17200                            1               22               0.845217        0.705334        0.985101</span>
<span class="sd">         23060                            0               21               0.845217        0.705334        0.985101</span>
<span class="sd">         27160                            0               20               0.845217        0.705334        0.985101</span>
<span class="sd">         28690                            0               19               0.845217        0.705334        0.985101</span>
<span class="sd">         37100                            0               18               0.845217        0.705334        0.985101</span>
<span class="sd">         38700                            1               17               0.795499        0.633417         0.95758</span>
<span class="sd">         40060                            0               16               0.795499        0.633417         0.95758</span>
<span class="sd">         45000                            1               15               0.742465        0.560893        0.924037</span>
<span class="sd">         45670                            0               14               0.742465        0.560893        0.924037</span>
<span class="sd">         49390                            1               13               0.685353         0.48621        0.884496</span>
<span class="sd">         53000                            0               12               0.685353         0.48621        0.884496</span>
<span class="sd">         67000                            0               11               0.685353         0.48621        0.884496</span>
<span class="sd">         69040                            1               10               0.616817        0.396904        0.836731</span>
<span class="sd">         69630                            0                9               0.616817        0.396904        0.836731</span>
<span class="sd">         72280                            1                8               0.539715        0.300949        0.778481</span>
<span class="sd">         77350                            0                7               0.539715        0.300949        0.778481</span>
<span class="sd">         78470                            0                6               0.539715        0.300949        0.778481</span>
<span class="sd">         91680                            0                5               0.539715        0.300949        0.778481</span>
<span class="sd">        105700                            0                4               0.539715        0.300949        0.778481</span>
<span class="sd">        106300                            0                3               0.539715        0.300949        0.778481</span>
<span class="sd">        131900                            1                2               0.269858               0        0.662446</span>
<span class="sd">        150400                            0                1               0.269858               0        0.662446</span>

<span class="sd">Results from KaplanMeier (95% CI):</span>
<span class="sd"> Failure times  Censoring code (censored=0)  Items remaining  Kaplan-Meier Estimate  Lower CI bound  Upper CI bound</span>
<span class="sd">          5248                            1               10                    0.9        0.714061               1</span>
<span class="sd">          7454                            1                9                    0.8        0.552082               1</span>
<span class="sd">         16890                            1                8                    0.7        0.415974        0.984026</span>
<span class="sd">         17200                            1                7                    0.6        0.296364        0.903636</span>
<span class="sd">         38700                            1                6                    0.5        0.190102        0.809898</span>
<span class="sd">         45000                            1                5                    0.4       0.0963637        0.703636</span>
<span class="sd">         49390                            1                4                    0.3       0.0159742        0.584026</span>
<span class="sd">         69040                            1                3                    0.2               0        0.447918</span>
<span class="sd">         72280                            1                2                    0.1               0        0.285939</span>
<span class="sd">        131900                            1                1                      0               0               0</span>
<span class="sd">'''</span>
</pre></div>
</div>
<img alt="_images/KaplanMeier_V3.png" src="_images/KaplanMeier_V3.png"/>
</section>
<section id="example-2">
<h2>Example 2<a class="headerlink" href="#example-2" title="Link to this heading"></a></h2>
<p>In this second example, we will create some data from a Weibull distribution, and then right censor the data above our chosen threshold. We will then fit a Weibull_2P distribution to the censored data, and also obtain the Kaplan-Meier estimate of this data. Using the results from the Fit_Weibull_2P and the Kaplan-Meier estimate, we will plot the CDF, SF, and CHF, for both the Weibull and Kaplan-Meier results. Note that the default plot from KaplanMeier will only give you the SF, but the results object provides everything you need to reconstruct the SF plot yourself, as well as what we need to plot the CDF and CHF.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Distributions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Weibull_Distribution</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Fitters</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fit_Weibull_2P</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Nonparametric</span><span class="w"> </span><span class="kn">import</span> <span class="n">KaplanMeier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Other_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_right_censored_data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">dist</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># create a distribution</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">random_samples</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># get some data from the distribution. Seeded for repeatability</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">make_right_censored_data</span><span class="p">(</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">wbf</span> <span class="o">=</span> <span class="n">Fit_Weibull_2P</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">failures</span><span class="p">,</span> <span class="n">right_censored</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">right_censored</span><span class="p">,</span> <span class="n">show_probability_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Fit the Weibull_2P</span>

<span class="c1"># Create the subplots and in each subplot we will plot the parametric distribution and obtain the Kaplan Meier fit.</span>
<span class="c1"># Note that the plot_type is being changed each time</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">KaplanMeier</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">failures</span><span class="p">,</span> <span class="n">right_censored</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">right_censored</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">'SF'</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Kaplan-Meier'</span><span class="p">)</span>
<span class="n">wbf</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">SF</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'Parametric'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'SF'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">KaplanMeier</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">failures</span><span class="p">,</span> <span class="n">right_censored</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">right_censored</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">'CDF'</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Kaplan-Meier'</span><span class="p">)</span>
<span class="n">wbf</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">CDF</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'Parametric'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'CDF'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">KaplanMeier</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">failures</span><span class="p">,</span> <span class="n">right_censored</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">right_censored</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">'CHF'</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Kaplan-Meier'</span><span class="p">)</span>
<span class="n">wbf</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">CHF</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'Parametric'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'CHF'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># format the plot layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/KM_all3functions_V4.png" src="_images/KM_all3functions_V4.png"/>
</section>
</section>
</div>
</div>