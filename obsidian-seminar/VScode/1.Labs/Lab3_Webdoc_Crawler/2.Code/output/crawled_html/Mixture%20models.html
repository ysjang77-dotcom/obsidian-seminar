<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<img alt="_images/logo.png" src="_images/logo.png"/>
<hr class="docutils"/>
<section id="mixture-models">
<h1>Mixture models<a class="headerlink" href="#mixture-models" title="Link to this heading"></a></h1>
<section id="what-are-mixture-models">
<h2>What are mixture models?<a class="headerlink" href="#what-are-mixture-models" title="Link to this heading"></a></h2>
<p>Mixture models are a combination of two or more distributions added together to create a distribution that has a shape with more flexibility than a single distribution. Each of the mixture’s components must be multiplied by a proportion, and the sum of all the proportions is equal to 1. The mixture is generally written in terms of the PDF, but since the CDF is the integral (cumulative sum) of the PDF, we can equivalently write the Mixture model in terms of the PDF or CDF. For a mixture model with 2 distributions, the equations are shown below:</p>
<p><span class="math notranslate nohighlight">\({PDF}_{mixture} = p\times{PDF}_1 + (1-p)\times{PDF}_2\)</span></p>
<p><span class="math notranslate nohighlight">\({CDF}_{mixture} = p\times{CDF}_1 + (1-p)\times{CDF}_2\)</span></p>
<p><span class="math notranslate nohighlight">\({SF}_{mixture} = 1-{CDF}_{mixture}\)</span></p>
<p><span class="math notranslate nohighlight">\({HF}_{mixture} = \frac{{PDF}_{mixture}}{{SF}_{mixture}}\)</span></p>
<p><span class="math notranslate nohighlight">\({CHF}_{mixture} = -ln({SF}_{mixture})\)</span></p>
<p>Mixture models are useful when there is more than one failure mode that is generating the failure data. This can be recognised by the shape of the PDF and CDF being outside of what any single distribution can accurately model. On a probability plot, a mixture of failure modes can be identified by bends or S-shapes in the data that you might otherwise expect to be linear. An example of this is shown in the image below. You should not use a mixture model just because it can fit almost anything really well, but you should use a mixture model if you suspect that there are multiple failure modes contributing to the failure data you are observing. To judge whether a mixture model is justified, look at the goodness of fit criterion (AICc or BIC) which penalises the score based on the number of parameters in the model. The closer the goodness of fit criterion is to zero, the better the fit. Using AD or log-likelihood for this check is not appropriate as these goodness of fit criterions do not penalise the score based on the number of parameters in the model and are therefore prone to overfitting.</p>
<p>See also <a class="reference external" href="https://reliability.readthedocs.io/en/latest/Competing%20risk%20models.html">competing risk models</a> for another method of combining distributions using the product of the SF rather than the sum of the CDF.</p>
<img alt="_images/mixture_required1.png" src="_images/mixture_required1.png"/>
</section>
<section id="creating-a-mixture-model">
<h2>Creating a mixture model<a class="headerlink" href="#creating-a-mixture-model" title="Link to this heading"></a></h2>
<p>Within <cite>reliability.Distributions</cite> is the Mixture_Model. This function accepts an array or list of standard distribution objects created using the <cite>reliability.Distributions</cite> module (available distributions are Exponential, Weibull, Gumbel, Normal, Lognormal, Loglogistic, Gamma, Beta). There is no limit to the number of components you can add to the mixture, but it is generally preferable to use as few as are required to fit the data appropriately (typically 2 or 3). In addition to the distributions, you can specify the proportions contributed by each distribution in the mixture. These proportions must sum to 1. If not specified the proportions will be set as equal for each component.</p>
<p>As this process is additive for the survival function, and may accept many distributions of different types, the mathematical formulation quickly gets complex. For this reason, the algorithm combines the models numerically rather than empirically so there are no simple formulas for many of the descriptive statistics (mean, median, etc.). Also, the accuracy of the model is dependent on xvals. If the xvals array is small (&lt;100 values) then the answer will be “blocky” and inaccurate. The variable xvals is only accepted for PDF, CDF, SF, HF, and CHF. The other methods (like random samples) use the default xvals for maximum accuracy. The default number of values generated when xvals is not given is 1000. Consider this carefully when specifying xvals in order to avoid inaccuracies in the results.</p>
<div class="admonition-api-reference admonition">
<p class="admonition-title">API Reference</p>
<p>For inputs and outputs see the <a class="reference external" href="https://reliability.readthedocs.io/en/latest/API/Distributions/Mixture_Model.html">API reference</a>.</p>
</div>
<section id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Link to this heading"></a></h3>
<p>The following example shows how the Mixture_Model object can be created, visualised and used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Distributions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lognormal_Distribution</span><span class="p">,</span> <span class="n">Gamma_Distribution</span><span class="p">,</span> <span class="n">Weibull_Distribution</span><span class="p">,</span> <span class="n">Mixture_Model</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># create the mixture model</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">Lognormal_Distribution</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">d3</span> <span class="o">=</span> <span class="n">Gamma_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">mixture_model</span> <span class="o">=</span> <span class="n">Mixture_Model</span><span class="p">(</span><span class="n">distributions</span><span class="o">=</span><span class="p">[</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">],</span> <span class="n">proportions</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="c1"># plot the 5 functions using the plot() function</span>
<span class="n">mixture_model</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="c1"># plot the PDF and CDF</span>
<span class="n">plot_components</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># this plots the component distributions. Default is False</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">mixture_model</span><span class="o">.</span><span class="n">PDF</span><span class="p">(</span><span class="n">plot_components</span><span class="o">=</span><span class="n">plot_components</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">mixture_model</span><span class="o">.</span><span class="n">CDF</span><span class="p">(</span><span class="n">plot_components</span><span class="o">=</span><span class="n">plot_components</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># extract the mean of the distribution</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'The mean of the distribution is:'</span><span class="p">,</span> <span class="n">mixture_model</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>

<span class="sd">'''</span>
<span class="sd">The mean of the distribution is: 74.91607709895453</span>
<span class="sd">'''</span>
</pre></div>
</div>
<img alt="_images/Weibull_Mixture_distV1.png" src="_images/Weibull_Mixture_distV1.png"/>
<img alt="_images/Weibull_Mixture_dist_propsV1.png" src="_images/Weibull_Mixture_dist_propsV1.png"/>
</section>
</section>
<section id="fitting-a-mixture-model">
<h2>Fitting a mixture model<a class="headerlink" href="#fitting-a-mixture-model" title="Link to this heading"></a></h2>
<p>Within <cite>reliability.Fitters</cite> is Fit_Weibull_Mixture. This function will fit a Weibull Mixture Model consisting of 2 x Weibull_2P distributions (this does not fit the gamma parameter). Just as with all of the other distributions in <cite>reliability.Fitters</cite>, right censoring is supported, though care should be taken to ensure that there still appears to be two groups when plotting only the failure data. A second group cannot be made from a mostly or totally censored set of samples.</p>
<p>Whilst some failure modes may not be fitted as well by a Weibull distribution as they may be by another distribution, it is unlikely that a mixture of data from two distributions (particularly if they are overlapping) will be fitted noticeably better by other types of mixtures than would be achieved by a Weibull mixture. For this reason, other types of mixtures are not implemented.</p>
<div class="admonition-api-reference admonition">
<p class="admonition-title">API Reference</p>
<p>For inputs and outputs see the <a class="reference external" href="https://reliability.readthedocs.io/en/latest/API/Fitters/Fit_Weibull_Mixture.html">API reference</a>.</p>
</div>
<section id="example-2">
<h3>Example 2<a class="headerlink" href="#example-2" title="Link to this heading"></a></h3>
<p>In this example, we will create some data using two Weibull distributions and then combine the data using np.hstack. We will then fit the Weibull mixture model to the combined data and will print the results and show the plot. As the input data is made up of 40% from the first group, we expect the proportion to be around 0.4.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Fitters</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fit_Weibull_Mixture</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Distributions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Weibull_Distribution</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Other_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">histogram</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># create some failures from two distributions</span>
<span class="n">group_1</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">random_samples</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">group_2</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">random_samples</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">all_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">group_1</span><span class="p">,</span> <span class="n">group_2</span><span class="p">])</span>  <span class="c1"># combine the data</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">Fit_Weibull_Mixture</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">all_data</span><span class="p">)</span> <span class="c1">#fit the mixture model</span>

<span class="c1"># this section is to visualise the histogram with PDF and CDF</span>
<span class="c1"># it is not part of the default output from the Fitter</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">histogram</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">PDF</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">histogram</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">cumulative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">CDF</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="sd">'''</span>
<span class="sd">Results from Fit_Weibull_Mixture (95% CI):</span>
<span class="sd">Analysis method: Maximum Likelihood Estimation (MLE)</span>
<span class="sd">Optimizer: TNC</span>
<span class="sd">Failures / Right censored: 100/0 (0% right censored)</span>

<span class="sd">   Parameter  Point Estimate  Standard Error  Lower CI  Upper CI</span>
<span class="sd">     Alpha 1         8.65511        0.393835   7.91663   9.46248</span>
<span class="sd">      Beta 1         3.91197        0.509776   3.03021    5.0503</span>
<span class="sd">     Alpha 2         38.1103         1.41075   35.4431   40.9781</span>
<span class="sd">      Beta 2         3.82192        0.421385   3.07916   4.74385</span>
<span class="sd">Proportion 1        0.388491       0.0502663  0.295595  0.490263</span>

<span class="sd">Goodness of fit    Value</span>
<span class="sd"> Log-likelihood -375.991</span>
<span class="sd">           AICc  762.619</span>
<span class="sd">            BIC  775.007</span>
<span class="sd">             AD 0.418649</span>
<span class="sd">'''</span>
</pre></div>
</div>
<img alt="_images/Weibull_Mixture_V6.png" src="_images/Weibull_Mixture_V6.png"/>
<img alt="_images/Weibull_Mixture_histV2.png" src="_images/Weibull_Mixture_histV2.png"/>
</section>
<section id="example-3">
<h3>Example 3<a class="headerlink" href="#example-3" title="Link to this heading"></a></h3>
<p>In this example, we will compare how well the Weibull Mixture performs vs a single Weibull_2P. Firstly, we generate some data from two Weibull distributions, combine the data, and right censor it above our chosen threshold. Next, we will fit the Mixture and Weibull_2P distributions. Then we will visualise the histogram and PDF of the fitted mixture model and Weibull_2P distributions. The goodness of fit measure is used to check whether the mixture model is really a much better fit than a single Weibull_2P distribution (which it is due to the lower BIC).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Fitters</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fit_Weibull_Mixture</span><span class="p">,</span> <span class="n">Fit_Weibull_2P</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Distributions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Weibull_Distribution</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Other_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">histogram</span><span class="p">,</span> <span class="n">make_right_censored_data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># create some failures and right censored data</span>
<span class="n">group_1</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">random_samples</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">group_2</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">random_samples</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">all_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">group_1</span><span class="p">,</span> <span class="n">group_2</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">make_right_censored_data</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="c1"># fit the Weibull Mixture and Weibull_2P</span>
<span class="n">mixture</span> <span class="o">=</span> <span class="n">Fit_Weibull_Mixture</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">failures</span><span class="p">,</span> <span class="n">right_censored</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">right_censored</span><span class="p">,</span> <span class="n">show_probability_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">single</span> <span class="o">=</span> <span class="n">Fit_Weibull_2P</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">failures</span><span class="p">,</span> <span class="n">right_censored</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">right_censored</span><span class="p">,</span> <span class="n">show_probability_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Weibull_Mixture BIC:'</span><span class="p">,</span> <span class="n">mixture</span><span class="o">.</span><span class="n">BIC</span><span class="p">,</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">Weibull_2P BIC:'</span><span class="p">,</span> <span class="n">single</span><span class="o">.</span><span class="n">BIC</span><span class="p">)</span> <span class="c1"># print the goodness of fit measure</span>

<span class="c1"># plot the Mixture and Weibull_2P</span>
<span class="n">histogram</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">white_above</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">mixture</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">PDF</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'Weibull Mixture'</span><span class="p">)</span>
<span class="n">single</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">PDF</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'Weibull_2P'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Comparison of Weibull_2P with Weibull Mixture'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="sd">'''</span>
<span class="sd">Weibull_Mixture BIC: 6431.578404076784</span>
<span class="sd">Weibull_2P BIC: 6511.511759597337</span>
<span class="sd">'''</span>
</pre></div>
</div>
<img alt="_images/Weibull_mixture_vs_Weibull_2P_V5.png" src="_images/Weibull_mixture_vs_Weibull_2P_V5.png"/>
</section>
</section>
</section>
</div>
</div>