<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<img alt="_images/logo.png" src="_images/logo.png"/>
<hr class="docutils"/>
<section id="rank-adjustment">
<h1>Rank Adjustment<a class="headerlink" href="#rank-adjustment" title="Link to this heading"></a></h1>
<div class="admonition-api-reference admonition">
<p class="admonition-title">API Reference</p>
<p>For inputs and outputs see the <a class="reference external" href="https://reliability.readthedocs.io/en/latest/API/Nonparametric/RankAdjustment.html">API reference</a>.</p>
</div>
<p>The Rank Adjustment estimator provides a method by which to estimate the survival function (reliability function) of a population without assuming that the data comes from a particular distribution. Due to the lack of parameters required in this model, it is a non-parametric method of obtaining the survival function. With a few simple transformations, the survival function (SF) can be used to obtain the cumulative hazard function (CHF) and the cumulative distribution function (CDF). It is not possible to obtain a useful version of the probability density function (PDF) or hazard function (HF) as this would require the differentiation of the CDF and CHF respectively, which results in a very spikey plot due to the non-continuous nature of these plots.</p>
<p>The Rank Adjustment estimator is very similar in result (but quite different in method) to the <a class="reference external" href="https://reliability.readthedocs.io/en/latest/Kaplan-Meier.html">Kaplan-Meier estimator</a> and <a class="reference external" href="https://reliability.readthedocs.io/en/latest/Nelson-Aalen.html">Nelson-Aalen estimator</a>. While none of the three has been proven to be more accurate than the others, the Kaplan-Meier estimator is generally more popular as a non-parametric means of estimating the SF. Confidence intervals are provided using the <a class="reference external" href="https://support.minitab.com/en-us/minitab/18/help-and-how-to/modeling-statistics/reliability/how-to/nonparametric-distribution-analysis-right-censoring/methods-and-formulas/estimation-methods/#confidence-intervals">Greenwood method</a> with Normal approximation.</p>
<p>The Rank Adjustment estimator can be used with both complete and right censored data. This function can be accessed from <cite>reliability.Nonparametric.RankAdjustment</cite>. The Rank-adjustment algorithm is the same as is used in Probability_plotting.plotting_positions to obtain the y-values for the scatter plot. As with plotting_positions, the heuristic constant “a” is accepted, with the default being 0.3 for median ranks.</p>
<section id="example-1">
<h2>Example 1<a class="headerlink" href="#example-1" title="Link to this heading"></a></h2>
<p>In this first example, we will see how Rank Adjustment compares with Kaplan-Meier and Nelson-Aalen for a large censored dataset. The plots show these three methods arrive at a similar result, with Kaplan-Meier giving the lowest estimate of the survival function, followed by Nelson-Aalen, and finally Rank-Adjustment. Note that this is when the median ranks are used in the Rank Adjustment heuristic. As sample size is increased, the differences between the three methods reduces.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Other_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_right_censored_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Nonparametric</span><span class="w"> </span><span class="kn">import</span> <span class="n">KaplanMeier</span><span class="p">,</span> <span class="n">NelsonAalen</span><span class="p">,</span> <span class="n">RankAdjustment</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Distributions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Weibull_Distribution</span>

<span class="n">dist</span> <span class="o">=</span> <span class="n">Weibull_Distribution</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">random_samples</span><span class="p">(</span><span class="n">number_of_samples</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">make_right_censored_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">raw_data</span><span class="p">,</span> <span class="n">fraction_censored</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># this will multiply-censor 50% of the data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">KaplanMeier</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">failures</span><span class="p">,</span> <span class="n">right_censored</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">right_censored</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Kaplan-Meier'</span><span class="p">)</span>
    <span class="n">NelsonAalen</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">failures</span><span class="p">,</span> <span class="n">right_censored</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">right_censored</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Nelson-Aalen'</span><span class="p">)</span>
    <span class="n">RankAdjustment</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">failures</span><span class="p">,</span> <span class="n">right_censored</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">right_censored</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Rank Adjustment'</span><span class="p">)</span>
    <span class="n">dist</span><span class="o">.</span><span class="n">SF</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">'Weibull Distribution'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="s1">' samples'</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'Comparison of Kaplan-Meier, Nelson-Aalen, and Rank Adjustment for varying sample sizes with 50</span><span class="si">% c</span><span class="s1">ensoring'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/KM_NA_RA.png" src="_images/KM_NA_RA.png"/>
</section>
<section id="example-2">
<h2>Example 2<a class="headerlink" href="#example-2" title="Link to this heading"></a></h2>
<p>In this second example we will look at the effect of the plotting heuristic “a”. The default heuristic used is 0.3 which gives the median ranks, but there are many <a class="reference external" href="https://en.wikipedia.org/wiki/Q%E2%80%93Q_plot#Heuristics">other heuristics</a> available by varying a from 0 to 1. Here we will look at the effect of setting “a” to be 0, 0.3, and 1. The effect is fairly minimal, though there is a small difference (which reduces as sample size increases) leading to the use of different heuristics. The median ranks (a=0.3) is most popular and is the default in most reliability engineering software for obtaining the plotting positions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">reliability.Nonparametric</span><span class="w"> </span><span class="kn">import</span> <span class="n">RankAdjustment</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5248</span><span class="p">,</span> <span class="mi">7454</span><span class="p">,</span> <span class="mi">16890</span><span class="p">,</span> <span class="mi">17200</span><span class="p">,</span> <span class="mi">38700</span><span class="p">,</span> <span class="mi">45000</span><span class="p">,</span> <span class="mi">49390</span><span class="p">,</span> <span class="mi">69040</span><span class="p">,</span> <span class="mi">72280</span><span class="p">,</span> <span class="mi">131900</span><span class="p">]</span>
<span class="n">rc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3961</span><span class="p">,</span> <span class="mi">4007</span><span class="p">,</span> <span class="mi">4734</span><span class="p">,</span> <span class="mi">6054</span><span class="p">,</span> <span class="mi">7298</span><span class="p">,</span> <span class="mi">10190</span><span class="p">,</span> <span class="mi">23060</span><span class="p">,</span> <span class="mi">27160</span><span class="p">,</span> <span class="mi">28690</span><span class="p">,</span> <span class="mi">37100</span><span class="p">,</span> <span class="mi">40060</span><span class="p">,</span> <span class="mi">45670</span><span class="p">,</span> <span class="mi">53000</span><span class="p">,</span> <span class="mi">67000</span><span class="p">,</span> <span class="mi">69630</span><span class="p">,</span> <span class="mi">77350</span><span class="p">,</span> <span class="mi">78470</span><span class="p">,</span> <span class="mi">91680</span><span class="p">,</span> <span class="mi">105700</span><span class="p">,</span> <span class="mi">106300</span><span class="p">,</span> <span class="mi">150400</span><span class="p">]</span>
<span class="n">a_trials</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">a_trials</span><span class="p">:</span>
    <span class="n">RankAdjustment</span><span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">right_censored</span><span class="o">=</span><span class="n">rc</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Heuristic 'a'"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Effect of rank adjustment heuristic'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/RAheuristic.png" src="_images/RAheuristic.png"/>
</section>
</section>
</div>
</div>